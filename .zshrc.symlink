# Env vars

## ZSH & Oh my zsh
ZSH_DISABLE_COMPFIX=true
ZSH=$HOME/.oh-my-zsh
DEFAULT_USER="danielkirsch"
HISTSIZE=1000
SAVEHIST=1000
plugins=(git)

# source here because it includes zsh overrides
[[ -a ~/.work.sh ]] && source ~/.work.sh

source $ZSH/oh-my-zsh.sh

# Detect OS
if [[ "$OSTYPE" == "darwin"* ]]; then
    export IS_MACOS=1
    [[ -f ~/.zshrc.macos ]] && source ~/.zshrc.macos
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    export IS_LINUX=1
    [[ -f ~/.zshrc.linux ]] && source ~/.zshrc.linux
fi

# Generic Path additions
export STACK_BIN="$HOME/.local/bin"
export CABAL_BIN=~/.cabal/bin
export COMPOSER_BIN="~/.composer/vendor/bin"
export KREW_BIN="${KREW_ROOT:-$HOME/.krew}/bin"

export PATH=$STACK_BIN:$CABAL_BIN:$COMPOSER_BIN:$KREW_BIN:$PATH

# Language version managers

# rbenv
load_rbenv () {
  if command -v rbenv > /dev/null; then eval "$(rbenv init -)"; fi
}

# nvm
load_nvm () {
    export NVM_DIR=~/.nvm
    [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
}

# Common tools detection and initialization
# (We check if the command exists before trying to eval/source)

# hub
if command -v hub &> /dev/null; then
  eval "$(hub alias -s)"
fi

# z (if available via brew or manual install)
if [[ -n $IS_MACOS ]] && command -v brew &> /dev/null; then
    [[ -f $(brew --prefix)/etc/profile.d/z.sh ]] && . $(brew --prefix)/etc/profile.d/z.sh
elif [[ -f /usr/share/z/z.sh ]]; then
    . /usr/share/z/z.sh
fi

# direnv
if command -v direnv &> /dev/null; then
  eval "$(direnv hook zsh)"
fi

# fzf
if command -v fzf &> /dev/null; then
  source <(fzf --zsh)
fi

# zoxide
if command -v zoxide &> /dev/null; then
  eval "$(zoxide init zsh)"
fi

# thefuck
if command -v thefuck &> /dev/null; then
  eval $(thefuck --alias)
fi

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR='vim'
else
  if command -v code &> /dev/null; then
    export EDITOR='code -w'
  else
    export EDITOR='vim'
  fi
fi
export SVN_EDITOR=$EDITOR
export VISUAL=$EDITOR

# Syntax highlighting & suggestions (load only if they exist)
if [[ -n $IS_MACOS ]] && command -v brew &> /dev/null; then
    [[ -f $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]] && source $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh
    [[ -f $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]] && source $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
elif [[ -f /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]]; then
    source /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh
    source /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
fi

# Prompt
if command -v starship &> /dev/null; then
  eval "$(starship init zsh)"
fi

# More imports
[[ -a ~/.aliases ]] && source ~/.aliases
[[ -a ~/.secrets.sh ]] && source ~/.secrets.sh
[[ -a ~/.work.sh ]] && source ~/.work.sh # source again if needed
[[ -a ~/.secrets.work.sh ]] && source ~/.secrets.work.sh

# SDKMAN
export SDKMAN_DIR="$HOME/.sdkman"
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

# Opencommit
export OCO_AI_PROVIDER="gemini"
export OCO_MODEL="gemini-2.5-flash"
export OCO_API_KEY=$GEMINI_API_KEY